<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upgrade Tree Editor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">MAIN GUN – Upgrade Tree Editor</div>
    <div class="toolbar">
      <button id="btnLoadGame" title="Load jsons/upgrades.json from game">Load from Game</button>
      <label class="filebtn" title="Open local JSON"><input id="fileOpen" type="file" accept="application/json">Open…</label>
      <button id="btnSave" title="Download as JSON">Save As…</button>
      <button id="btnCopy" title="Copy JSON to clipboard">Copy JSON</button>
      <span class="sep"></span>
      <button id="btnAddNode">Add Node</button>
      <button id="btnRemoveNode" disabled>Remove Node</button>
      <span class="sep"></span>
      <span class="status">Nodes: <span id="statNodes">0</span></span>
    </div>
  </header>

  <main class="workspace">
    <aside class="side left">
      <div class="panel">
        <div class="panel-title">Trees</div>
        <div class="row">
          <select id="treeSelect"></select>
        </div>
        <div class="row">
          <input id="treeName" type="text" placeholder="Tree name">
        </div>
        <div class="row buttons">
          <button id="btnAddTree">+ Tree</button>
          <button id="btnRemoveTree">- Tree</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">Zoom / Pan</div>
        <div class="row">
          <button id="btnZoomOut">-</button>
          <button id="btnZoomReset">100%</button>
          <button id="btnZoomIn">+</button>
        </div>
        <div class="hint">Wheel: Zoom / Drag: Pan</div>
      </div>

      <div class="panel">
        <div class="panel-title">Help</div>
        <ul class="help">
          <li>Drag node to move (position is saved 0..1)</li>
          <li>In Inspector, use Requires to set parents</li>
          <li>Effects: weapon.* or status_* (same as game)</li>
        </ul>
      </div>
    </aside>

    <section class="canvas-wrap" id="canvasWrap">
      <svg id="edges" class="edges" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet"></svg>
      <div id="nodes" class="nodes"></div>
      <div class="points-badge">Tree: <span id="lblTreeName"></span></div>
    </section>

    <aside class="side right">
      <div class="panel">
        <div class="panel-title">Inspector</div>
        <div class="row"><label>Id</label><input id="propId" type="text"></div>
        <div class="row"><label>Name</label><input id="propName" type="text"></div>
        <div class="row"><label>Icon</label><input id="propIcon" type="text" placeholder="e.g. ⚙️"></div>
        <div class="row"><label>Description</label><textarea id="propDesc" rows="3"></textarea></div>
        <div class="row"><label>Cost</label><input id="propCost" type="number" min="0" step="1"></div>
        <div class="row"><label>Max Level</label><input id="propMaxLv" type="number" min="1" step="1"></div>
        <div class="row"><label>Position X</label><input id="propPosX" type="number" min="0" max="1" step="0.001"></div>
        <div class="row"><label>Position Y</label><input id="propPosY" type="number" min="0" max="1" step="0.001"></div>
      </div>

      <div class="panel">
        <div class="panel-title">Requires (Parents)</div>
        <div class="row"><label>Logic</label><select id="reqLogic"><option value="and">AND</option><option value="or">OR</option></select></div>
        <div class="requires" id="requiresList"></div>
      </div>

      <div class="panel">
        <div class="panel-title">Effects</div>
        <div id="effectsList"></div>
        <button id="btnAddEffect">+ Effect</button>
      </div>
    </aside>
  </main>

  <template id="tplNode">
    <div class="node-card" data-node-id="">
      <div class="head">
        <div class="title">NODE</div>
        <div class="icon">⚙️</div>
      </div>
      <div class="body">Description</div>
      <div class="footer"><button class="btn select">SELECT</button></div>
    </div>
  </template>

  <template id="tplEffect">
    <div class="effect-row">
      <select class="ef-kind">
        <option value="stat">stat</option>
        <option value="special">special</option>
      </select>
      <input class="ef-target" type="text" placeholder="weapon.fireCooldownMs or path e.g. chill.dpsGrowthMul">
      <select class="ef-op">
        <option value="add">add</option>
        <option value="mul">mul</option>
      </select>
      <input class="ef-value" type="number" step="0.001" placeholder="value">
      <button class="ef-del">×</button>
    </div>
  </template>

  <script src="editor.js" defer></script>
</body>
</html>
